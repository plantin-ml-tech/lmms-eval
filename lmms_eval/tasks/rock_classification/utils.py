from PIL import Image


def rock_doc_to_visual(doc):
    """Resize image to 448x448 with aspect ratio preservation using padding"""
    image = doc["image"]

    if isinstance(image, str):
        image = Image.open(image)

    img = image.copy()
    img.thumbnail((448, 448), Image.Resampling.LANCZOS)

    new_image = Image.new("RGB", (448, 448), (255, 255, 255))
    paste_x = (448 - img.width) // 2
    paste_y = (448 - img.height) // 2
    new_image.paste(img, (paste_x, paste_y))

    return new_image


class_names = [
    "actinolite",
    "adamellite",
    "adamite",
    "agate",
    "albite",
    "alexandrite",
    "alkali-feldspar",
    "alkali-feldspar-granite",
    "almandine-garnet",
    "amazonite",
    "amber",
    "amblygonite",
    "amethyst",
    "ametrine",
    "ammolite",
    "amphibolite",
    "analcime",
    "anatase",
    "andesine",
    "andesite",
    "andradite",
    "anglesite",
    "anorthite",
    "anthracite",
    "anyolite",
    "apatite",
    "apophylite",
    "aquamarine",
    "aragonite",
    "argillite",
    "arkansas",
    "arkose",
    "augelite",
    "avanturine",
    "axinite",
    "azurite",
    "banded-iron-formation",
    "barite",
    "basalt-2",
    "bayldonite",
    "benitoite",
    "black-tourmaline",
    "bloodstone",
    "blue-granite",
    "blueschist",
    "boracite",
    "bornite",
    "brazilianite",
    "breccia",
    "brimstone-sulfur",
    "brookite",
    "brucite",
    "bytownite",
    "cacoxenite",
    "calcite",
    "cancrinite",
    "carnelian",
    "cassiterite",
    "cataclasite",
    "catapleiite",
    "celestite",
    "ceruleite",
    "cerussite",
    "chabazite",
    "chalcanthite",
    "chalcedony",
    "chalk",
    "charoite",
    "chert",
    "chicken-blood-stone",
    "childrenite",
    "chromite",
    "chrysoberyl",
    "chrysocolla",
    "chrysoprase",
    "coal",
    "cobaltite",
    "conglomerate",
    "coquina",
    "corundum",
    "covellite",
    "creedite",
    "crocoite",
    "cryolite",
    "cuprite",
    "dacite",
    "dalmation-jasper",
    "danburite",
    "datolite",
    "demantoid-garnet",
    "desert-rose",
    "diabase",
    "diamond",
    "diaspore",
    "diatomite",
    "diopside",
    "dioptase",
    "diorite",
    "dolomite-rock",
    "dunite",
    "eclogite",
    "emerald",
    "enstatite",
    "epidosite",
    "epidot",
    "essexite",
    "ettringite",
    "eudialyte",
    "euxenite",
    "evaporite",
    "feldspar",
    "felsite",
    "flint",
    "fluorite",
    "freshwater-pearl",
    "fuchsite",
    "gabbro",
    "gadolinite",
    "gadolinite-2",
    "garnet",
    "geode",
    "geyserite",
    "gneiss",
    "goethite",
    "golden-beryl",
    "gossan",
    "grandidierite",
    "granite-2",
    "granodiorite",
    "granophyre",
    "granulite",
    "grape-agate",
    "green-onyx",
    "greenschist",
    "grossular-garnet",
    "gypsum",
    "hambergite",
    "harzburgite",
    "hecatolite-moonstone",
    "hematite",
    "hemimorphite",
    "herderite",
    "hessonite",
    "hornblende",
    "hornblendite",
    "hornfels",
    "howlite",
    "huebnerite",
    "hyaloclastite",
    "hydrogrossular-garnet",
    "hypersthene",
    "ignimbrite",
    "indicolite",
    "iolite",
    "jadeitite",
    "jasper",
    "jasperoid",
    "jaspillite",
    "jeremejevite",
    "jet",
    "kalsititic",
    "kämmererite",
    "kimberlite",
    "komatiite",
    "kunzite",
    "kyanite",
    "labradorite",
    "lamproite",
    "lamprophyre",
    "larimar",
    "laterite",
    "lazurite",
    "legrandite",
    "lemurian-quartz",
    "lepidolite",
    "lherzolite",
    "lignite",
    "limestone",
    "linarite",
    "llanite",
    "ludlamite",
    "luxullianite",
    "magnesite",
    "magnetite",
    "mahogany-obsidian",
    "malachite",
    "malaia-garnet",
    "mali-garnet",
    "marble",
    "marcasite",
    "marialite",
    "melitte",
    "meteorite-impact",
    "micaceous",
    "microlite",
    "migmatite",
    "millerite",
    "moldavite",
    "monazite",
    "mordenite",
    "morganite",
    "moss-agate",
    "mudstone",
    "mylonite",
    "nepheline",
    "nepheline-syenite",
    "nephelite",
    "nephrite",
    "neptunite",
    "niccolite-nickeline",
    "norite",
    "novaculite",
    "obsidian",
    "oil-shale",
    "oligoclase",
    "olivine",
    "onyx",
    "oolite",
    "opal",
    "orthoclase",
    "padparadscha",
    "painite",
    "palygorskite",
    "papagoite",
    "pargasite",
    "parisite",
    "peach-moonstone",
    "pegmatite",
    "pentlandite",
    "peridot",
    "peridotite",
    "peristerite",
    "petalite",
    "phenacite",
    "phenocrysts",
    "phonotephrite",
    "phosphate-minerals",
    "phosphorite",
    "phyllite",
    "picrite",
    "pietersite",
    "plagioclase",
    "pollucite",
    "porphyry",
    "powellite",
    "prasiolite",
    "proustite",
    "pseudotachylite",
    "pumice",
    "purpurite",
    "pyrargyrite",
    "pyrite",
    "pyrophyllite",
    "pyroxene",
    "pyroxenite",
    "pyrrhotite",
    "quartz-mezonite",
    "quartzite",
    "rapakivi-granite",
    "realgar",
    "red-beryl",
    "rhodizite",
    "rhodochrosite",
    "rhodolite-garnet",
    "rhodonite",
    "rhyodacite",
    "rhyolite",
    "rodingite",
    "romb-porphyry",
    "rose-quartz",
    "rubellite",
    "ruby",
    "ruby-fuchsite",
    "rutilated-quartz",
    "sandstone",
    "sanidine",
    "sapphire",
    "sapphirine",
    "sardonyx",
    "scheelite",
    "schist",
    "scolecite",
    "scoria",
    "scorodite",
    "selenite",
    "septarian",
    "serandite",
    "seraphinite",
    "serpentine",
    "serpentinite",
    "shale",
    "shattuckite",
    "shiva-lingam",
    "shungite",
    "sillimanite",
    "skarn",
    "slate",
    "smithsonite",
    "smoky-quartz",
    "snowflake-obsidian",
    "sodalite",
    "sovite",
    "spectrolite",
    "spessartite-garnet",
    "sphalerite",
    "sphene",
    "spinel",
    "spodumene",
    "staurolite",
    "stichtite",
    "stilstone",
    "stolzite",
    "suevite",
    "sugilite",
    "sunstone",
    "sylvinite",
    "taaffeite",
    "tachylite",
    "taconite",
    "talc",
    "talc-carbonate",
    "tantalite",
    "tanzanite",
    "tectonite",
    "thaumasite",
    "thomsonite",
    "tigers-eye",
    "tillite",
    "tonalite",
    "topaz",
    "tourmaline",
    "trachyte",
    "travertine",
    "tremolite",
    "troctolite",
    "tsavorite",
    "tufa",
    "tuff",
    "tugtupite",
    "turbidite",
    "turquoise",
    "ulexite",
    "unakite",
    "uvarovite",
    "vanadinite",
    "variolite",
    "variscite",
    "väyrynenite",
    "vesuvianite",
    "villiaumite",
    "vivianite",
    "watermelon-tourmaline",
    "wavellite",
    "wehrlite",
    "willemite",
    "witherite",
    "wollastonite",
    "wulfenite",
    "zincite",
    "zircon",
    "zunyite",
    "сinnabar",
]


def rock_doc_to_text(doc):
    base_prompt = (
        """You are an expert geologist specializing in rock and mineral identification. Analyze the image carefully and identify the specific rock or mineral shown.

        TASK: Identify the exact rock or mineral type in this image.

        INSTRUCTIONS:
        1. Examine the visual characteristics: color, texture, crystal structure, luster, and geological formation patterns
        2. Consider distinctive features like banding, crystalline structure, opacity, and surface appearance
        3. Match your observations to the provided classification options
        4. Respond with ONLY the exact classification name in lowercase
        5. Do not provide explanations, descriptions, or alternative options

        CLASSIFICATION OPTIONS:
        """
        + ", ".join(class_names)
        + """

        IMPORTANT CONSTRAINTS:
        - Answer with exactly ONE word in lowercase
        - Must be from the provided options list
        - No additional text or explanations
        - Focus on the most distinctive geological features visible

        Your answer:"""
    )

    return base_prompt


def rock_doc_to_target(doc):
    return doc["label"]
